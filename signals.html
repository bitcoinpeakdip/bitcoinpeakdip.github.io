<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Add meta tags for cache control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    
    <!-- CSS với version parameter -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/main.css?v=1.1">
    <link rel="stylesheet" href="styles/signals.css?v=1.4">
    <link rel="stylesheet" href="styles/zoom.css?v=1.1">
    
    <!-- JS với version parameter -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="theme-color" content="#f7931a">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="PeakDip EWS">

	<!-- PWA Manifest -->
	<link rel="manifest" href="/manifest.json">

	<!-- iOS Icons -->
	<link rel="apple-touch-icon" href="/icons/icon-192x192.png">
	<link rel="apple-touch-startup-image" href="/icons/splash-screen.png">

	<!-- PWA Install Prompt -->
	<link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
	<link rel="shortcut icon" type="image/x-icon" href="/icons/favicon.ico">	
</head>
<body>
	<!-- Thêm ngay sau <body> -->
	<div class="data-status-banner" id="dataStatusBanner" style="display: none;">
		<div class="status-content">
			<i class="fas fa-exclamation-triangle"></i>
			<span id="statusMessage">No CSV data loaded</span>
			<button onclick="loadRealCSVData()" class="retry-btn">
				<i class="fas fa-redo"></i> Retry
			</button>
		</div>
	</div>

	<script>
		// Add CSS for status banner
		const style = document.createElement('style');
		style.textContent = `
			.data-status-banner {
				position: fixed;
				top: 70px;
				left: 0;
				right: 0;
				background: linear-gradient(to right, #f44336, #ff9800);
				color: white;
				padding: 12px 20px;
				z-index: 9999;
				text-align: center;
				font-weight: bold;
				box-shadow: 0 2px 10px rgba(0,0,0,0.2);
			}
			.status-content {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 15px;
			}
			.retry-btn {
				background: rgba(255,255,255,0.2);
				border: 1px solid rgba(255,255,255,0.3);
				color: white;
				padding: 5px 15px;
				border-radius: 4px;
				cursor: pointer;
			}
			.retry-btn:hover {
				background: rgba(255,255,255,0.3);
			}
		`;
		document.head.appendChild(style);
	</script>	

    <!-- Interactive Background -->
    <div class="interactive-background" id="interactiveBackground"></div>
    
    <!-- Sensor Alert Container -->
    <div class="sensor-alert" id="sensorAlert"></div>
    
    <!-- Navigation Menu -->
    <nav class="navigation" id="navigation">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <i class="fas fa-wave-square"></i>
                Bitcoin PeakDip
            </a>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-menu" id="navMenu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">About</a>
                </li>
                <li class="nav-item">
                    <a href="product.html" class="nav-link">Product</a>
                </li>
                <li class="nav-item">
                    <a href="signals.html" class="nav-link active">EWS Signals</a>
                </li>
                <li class="nav-item">
                    <a href="#learn" class="nav-link">Learn</a>
                </li>
                <li class="nav-item">
                    <a href="#contact" class="nav-link">Contact</a>
                </li>
            </ul>
        </div>
    </nav>
    
    <!-- Sensor Network Background -->
    <div class="sensor-network">
        <!-- Sensor Rings -->
        <div class="sensor-ring ring-1"></div>
        <div class="sensor-ring ring-2"></div>
        <div class="sensor-ring ring-3"></div>
        <div class="sensor-ring ring-4"></div>
        
        <!-- Bitcoin Waves -->
        <div class="bitcoin-waves">
            <div class="bitcoin-wave wave-1"></div>
            <div class="bitcoin-wave wave-2"></div>
            <div class="bitcoin-wave wave-3"></div>
        </div>
        
        <!-- Energy Particles Container -->
        <div class="energy-particles" id="energyParticles"></div>
        
        <!-- Bitcoin Visualization -->
        <div class="bitcoin-visualization">
            <div class="bitcoin-wave"></div>
        </div>
    </div>
    
    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">
        <div class="status-light status-peak" id="statusLight"></div>
        <div class="status-text" id="statusText">ANALYSING SIGNALS LOG</div>
    </div>
    
    <!-- Main Content -->
    <div class="content-container">
        <!-- Signals Header -->
        <div class="signals-header">
            <h1 class="signals-title">EWS Signals Log</h1>
            <p class="signals-subtitle">Real-time Bitcoin Peak and Dip Detection Records</p>
            <div class="signals-badge">
                <i class="fas fa-satellite-dish"></i> LIVE SIGNAL MONITORING
            </div>
        </div>
        
        <!-- Real-time Stats -->
        <div class="signals-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-mountain"></i>
                </div>
                <div class="stat-content">
                    <h3>Peak Signals</h3>
                    <div class="stat-value" id="peakCount">0</div>
                    <div class="stat-label">Local Peaks Detected</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-water"></i>
                </div>
                <div class="stat-content">
                    <h3>Dip Signals</h3>
                    <div class="stat-value" id="dipCount">0</div>
                    <div class="stat-label">Local Dips Detected</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Signals</h3>
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">All Signals Recorded</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-content">
                    <h3>Accuracy</h3>
                    <div class="stat-value" id="accuracyRate">0%</div>
                    <div class="stat-label">Signal Precision</div>
                </div>
            </div>
        </div>
        
        <!-- Bitcoin Price Chart with Signals -->
        <section class="chart-section">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> Bitcoin Price Chart with EWS Signals</h2>
                <div class="chart-controls">
                    <button class="control-btn active" data-timeframe="1d">1D</button>
                    <button class="control-btn" data-timeframe="7d">7D</button>
                    <button class="control-btn" data-timeframe="30d">30D</button>
                    <button class="control-btn" data-timeframe="90d">90D</button>
					<button class="control-btn" id="resetViewBtn">
						<i class="fas fa-sync-alt"></i> Reset
					</button>					
                    <div class="chart-legend">
                        <span class="legend-item peak">
                            <i class="fas fa-circle"></i> Peak Signal
                        </span>
                        <span class="legend-item dip">
                            <i class="fas fa-circle"></i> Dip Signal
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="bitcoinChart"></canvas>
            </div>
            <div class="zoom-toolbar" style="display: none;" id="zoomToolbar">
                <!-- Content sẽ được thêm bởi JavaScript -->
            </div>            
            <div class="chart-info">
                <div class="info-item">
                    <i class="fas fa-info-circle"></i>
                    <p>Red markers indicate local peak detection zones. Blue markers indicate local dip detection zones.</p>
                </div>
                <div class="info-item">
                    <i class="fas fa-database"></i>
                    <p>Data loaded from CSV file and mapped to Bitcoin price chart in real-time.</p>
                </div>
            </div>
        </section>
        
        <!-- Signals Log Table -->
        <section class="signals-log-section">
            <div class="section-header">
                <h2><i class="fas fa-list-alt"></i> Signals Log</h2>
                <div class="log-controls">
                    <div class="filter-controls">
                        <button class="filter-btn active" data-filter="all">All Signals</button>
                        <button class="filter-btn" data-filter="peak">Peak Only</button>
                        <button class="filter-btn" data-filter="dip">Dip Only</button>
                        <button class="filter-btn" data-filter="high-confidence">High Confidence</button>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="signalSearch" placeholder="Search signals...">
                    </div>
                </div>
            </div>
			<div class="mobile-scroll-hint">
				<i class="fas fa-arrows-alt-h"></i> 
				<span class="hint-text">Kéo bảng sang trái/phải để xem đầy đủ thông tin</span>
				<div class="hint-sub">↔️ Nhấn và kéo tại bất kỳ đâu trong bảng</div>
			</div>         
            <div class="log-container">
                <table class="signals-table" id="signalsTable">
                    <thead>
                        <tr>
                            <th>
                                <i class="fas fa-calendar"></i>
                                Date & Time
                            </th>
                            <th>
                                <i class="fas fa-bullseye"></i>
                                Signal Type
                            </th>
                            <th>
                                <i class="fas fa-chart-bar"></i>
                                Price
                            </th>
                            <th>
                                <i class="fas fa-tachometer-alt"></i>
                                Confidence
                            </th>
                            <th>
                                <i class="fas fa-ruler-combined"></i>
                                Distance
                            </th>
                            <th>
                                <i class="fas fa-check-circle"></i>
                                Validation
                            </th>
                            <th>
                                <i class="fas fa-tags"></i>
                                Strategy
                            </th>
                        </tr>
                    </thead>
                    <tbody id="signalsTableBody">
                        <!-- Data will be loaded from CSV -->
                        <tr class="loading-row">
                            <td colspan="7">
                                <div class="loading-spinner">
                                    <i class="fas fa-sync fa-spin"></i>
                                    Loading EWS signals from CSV...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="pagination">
                    <button class="page-btn" id="prevPage" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="page-info">
                        Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                    </div>
                    <button class="page-btn" id="nextPage" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="data-source-info">
                <i class="fas fa-file-csv"></i>
                <p>Data source: <code>data/signals.csv</code> • Last updated: <span id="lastUpdated">Loading...</span></p>
                <button class="refresh-btn" id="refreshData">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
            </div>
        </section>
        
        <!-- Signal Details Panel -->
        <section class="details-section">
            <h2><i class="fas fa-search"></i> Signal Details</h2>
            <div class="details-container" id="signalDetails">
                <div class="no-selection">
                    <i class="fas fa-mouse-pointer"></i>
                    <h3>Select a signal from the table</h3>
                    <p>Click on any signal in the log table to view detailed analysis and chart position.</p>
                </div>
            </div>
        </section>
        
        <!-- Signal Analysis -->
        <section class="analysis-section">
            <h2><i class="fas fa-chart-pie"></i> Signal Analysis</h2>
            
            <div class="analysis-grid">
                <div class="analysis-card">
                    <h3><i class="fas fa-chart-bar"></i> Distribution by Type</h3>
                    <div class="chart-small">
                        <canvas id="typeDistributionChart"></canvas>
                    </div>
                    <div class="analysis-stats">
                        <div class="analysis-stat">
                            <span class="stat-label">Peak Signals:</span>
                            <span class="stat-value" id="peakPercentage">0%</span>
                        </div>
                        <div class="analysis-stat">
                            <span class="stat-label">Dip Signals:</span>
                            <span class="stat-value" id="dipPercentage">0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-card">
                    <h3><i class="fas fa-tachometer-alt"></i> Confidence Levels</h3>
                    <div class="chart-small">
                        <canvas id="confidenceChart"></canvas>
                    </div>
                    <div class="analysis-stats">
                        <div class="analysis-stat">
                            <span class="stat-label">High Confidence:</span>
                            <span class="stat-value" id="highConfidence">0</span>
                        </div>
                        <div class="analysis-stat">
                            <span class="stat-label">Medium Confidence:</span>
                            <span class="stat-value" id="mediumConfidence">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-card">
                    <h3><i class="fas fa-clock"></i> Time Distribution</h3>
                    <div class="chart-small">
                        <canvas id="timeDistributionChart"></canvas>
                    </div>
                    <div class="analysis-stats">
                        <div class="analysis-stat">
                            <span class="stat-label">Signals Today:</span>
                            <span class="stat-value" id="signalsToday">0</span>
                        </div>
                        <div class="analysis-stat">
                            <span class="stat-label">This Week:</span>
                            <span class="stat-value" id="signalsWeek">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- CSV Data Format Info -->
		<!-- CSV Data Format Info -->
		<section class="csv-info-section">
			<h2><i class="fas fa-file-code"></i> CSV Data Format</h2>
			<div class="csv-format">
				<div class="format-example">
					<h3><i class="fas fa-table"></i> Example CSV Structure</h3>
					<pre><code>timestamp,signal_type,price,confidence,distance,validation,strategy
		2024-01-15T08:30:00,PEAK,45000.50,85,2.5,VALIDATED,RECLAIM_FAILURE
		2024-01-15T12:45:00,DIP,44200.75,92,1.8,VALIDATED,DISTRIBUTION_FADE
		2024-01-16T09:15:00,PEAK,45500.25,78,3.2,PENDING,HEDGE_FLIP</code></pre>
				</div>
				
				<div class="format-details">
					<h3><i class="fas fa-info-circle"></i> Field Descriptions & Update Instructions</h3>
					<ul>
						<li><strong>timestamp:</strong> ISO 8601 format (YYYY-MM-DDTHH:MM:SS) or M/D/YYYY HH:MM</li>
						<li><strong>signal_type:</strong> PEAK or DIP</li>
						<li><strong>price:</strong> Bitcoin price at signal detection</li>
						<li><strong>confidence:</strong> 0-100 score (higher = more confident)</li>
						<li><strong>distance:</strong> Distance from ideal entry (%)</li>
						<li><strong>validation:</strong> VALIDATED, PENDING, or INVALID</li>
						<li><strong>strategy:</strong> Which strategy triggered the signal</li>
						<li style="color: #ff9800; font-weight: bold; border-left: 3px solid #ff9800; padding-left: 10px; background: rgba(255, 152, 0, 0.1); margin-top: 15px;">
							<i class="fas fa-code-branch"></i> <strong>UPDATE METHOD:</strong> CSV file can only be updated via Git commits. Direct upload is disabled for security.
						</li>
					</ul>
				</div>
			</div>
			
			<div class="csv-actions">
				<a href="data/signals.csv" class="csv-btn" download>
					<i class="fas fa-download"></i> Download Current CSV
				</a>
				<div class="update-info">
					<i class="fas fa-code-branch"></i>
					<span>CSV updates via Git commit only</span>
				</div>
			</div>
		</section>
        
		<div class="git-update-info">
			<i class="fas fa-git-alt"></i>
			<strong>Git Commit Updates:</strong> This page automatically detects when signals.csv is updated via Git commits and notifies you.
		</div>		
		<!-- Back to Home -->
        <div class="back-home">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
        </div>
        
        <!-- Footer -->
        <footer id="pageFooter">
            <p>© 2024 Bitcoin PeakDip Early Warning System. All rights reserved.</p>
            
            <div class="footer-links">
                <a href="index.html" class="footer-link">Home</a>
                <a href="about.html" class="footer-link">About</a>
                <a href="product.html" class="footer-link">Product</a>
                <a href="signals.html" class="footer-link active">EWS Signals</a>
                <a href="#learn" class="footer-link">Learn</a>
                <a href="#contact" class="footer-link">Contact</a>
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link">Risk Disclosure</a>
            </div>
        </footer>
    </div>
    
    <!-- CSV Data -->
    <script id="csvData" type="application/json">
    </script>
    <!-- Thêm đoạn này trước </body> -->
    <script>
        // Load CSV từ file thực
        fetch('data/signals.csv')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Failed to load CSV: ${response.status} ${response.statusText}`);
                }
                return response.text();
            })
            .then(csvText => {
                window.realCsvData = csvText;
                console.log('✅ CSV loaded successfully from data/signals.csv');
                console.log('CSV length:', csvText.length, 'characters');
                console.log('First 3 lines:', csvText.split('\n').slice(0, 3).join('\n'));
                
                // Dispatch event để signals.js biết dữ liệu đã sẵn sàng
                const event = new CustomEvent('csvDataReady', { 
                    detail: { csvText: csvText } 
                });
                document.dispatchEvent(event);
            })
            .catch(error => {
                console.error('❌ Error loading CSV:', error);
                
                // Try alternative path if data/ doesn't work
                fetch('signals.csv')
                    .then(response => response.text())
                    .then(csvText => {
                        console.log('⚠️  Loaded from alternative path (signals.csv)');
                        window.realCsvData = csvText;
                        const event = new CustomEvent('csvDataReady', { 
                            detail: { csvText: csvText } 
                        });
                        document.dispatchEvent(event);
                    })
                    .catch(error2 => {
                        console.error('❌ Failed all CSV paths');
                    });
            });
    </script>
    <!-- Thêm ngay sau <body> -->
    <div class="loading-indicator" id="globalLoading">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Loading Bitcoin EWS Signals...</span>
    </div>

    <script>
        // Hide loading when page is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const loading = document.getElementById('globalLoading');
                if (loading) {
                    loading.style.opacity = '0';
                    setTimeout(() => {
                        if (loading.parentNode) {
                            loading.parentNode.removeChild(loading);
                        }
                    }, 300);
                }
            }, 2000);
        });
    </script>
    <script src="js/main.js?v=1.1"></script>
    <script src="js/signals.js?v=1.4"></script> <!-- Đổi số này mỗi lần update -->	
</body>
</html>